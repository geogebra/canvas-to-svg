{"version":3,"file":"cytoscape-svg.js","sources":["../src/helpers.ts","../src/shared.ts","../src/CanvasToSvg.ts","src/convert-to-svg.js","src/index.js"],"sourcesContent":["//helper function to format a string\nexport function format(str: string, args: any): string {\n  var keys = Object.keys(args),\n    i;\n  for (i = 0; i < keys.length; i++) {\n    str = str.replace(new RegExp(\"\\\\{\" + keys[i] + \"\\\\}\", \"gi\"), args[keys[i]]);\n  }\n  return str;\n}\n\n//helper function that generates a random string\nexport function randomString(holder: Record<string, unknown>) {\n  var chars, randomstring, i;\n  if (!holder) {\n    throw new Error(\n      \"cannot create a random attribute name for an undefined object\"\n    );\n  }\n  chars = \"ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz\";\n  randomstring = \"\";\n  do {\n    randomstring = \"\";\n    for (i = 0; i < 12; i++) {\n      randomstring += chars[Math.floor(Math.random() * chars.length)];\n    }\n  } while (holder[randomstring]);\n  return randomstring;\n}\n\n//helper function to map named to numbered entities\nexport function createNamedToNumberedLookup(items: string, radix = 10) {\n  let i,\n    entity,\n    lookup = {} as Record<string, string>,\n    base10;\n  const itemsArr = items.split(\",\");\n  // Map from named to numbered entities.\n  for (i = 0; i < itemsArr.length; i += 2) {\n    entity = \"&\" + itemsArr[i + 1] + \";\";\n    base10 = parseInt(itemsArr[i], radix);\n    lookup[entity] = \"&#\" + base10 + \";\";\n  }\n  //FF and IE need to create a regex from hex values ie &nbsp; == \\xa0\n  lookup[\"\\\\xa0\"] = \"&#160;\";\n  return lookup;\n}\n\n//TODO: support rtl languages\nconst getTextAnchorMap = {\n  left: \"start\",\n  right: \"end\",\n  center: \"middle\",\n  start: \"start\",\n  end: \"end\",\n};\n//helper function to map canvas-textAlign to svg-textAnchor\nexport function getTextAnchor(textAlign: keyof typeof getTextAnchorMap) {\n  return getTextAnchorMap[textAlign] || getTextAnchorMap.start;\n}\n\n//INFO: not supported in all browsers\nconst getDominantBaselineMap = {\n  alphabetic: \"alphabetic\",\n  hanging: \"hanging\",\n  top: \"text-before-edge\",\n  bottom: \"text-after-edge\",\n  middle: \"central\",\n};\n//helper function to map canvas-textBaseline to svg-dominantBaseline\nexport function getDominantBaseline(\n  textBaseline: keyof typeof getDominantBaselineMap\n) {\n  return (\n    getDominantBaselineMap[textBaseline] || getDominantBaselineMap.alphabetic\n  );\n}\n\n/**\n * Return a new normalized vector of given vector\n */\nexport const normalize = function (vector: [number, number]) {\n  var len = Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\n  return [vector[0] / len, vector[1] / len];\n};\n","import { createNamedToNumberedLookup, format } from \"./helpers\";\n\nexport const namedEntities = createNamedToNumberedLookup(\n  \"50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,\" +\n    \"5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,\" +\n    \"5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,\" +\n    \"5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,\" +\n    \"68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,\" +\n    \"6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,\" +\n    \"6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,\" +\n    \"75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,\" +\n    \"7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,\" +\n    \"7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,\" +\n    \"sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,\" +\n    \"st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,\" +\n    \"t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,\" +\n    \"tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,\" +\n    \"u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,\" +\n    \"81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,\" +\n    \"8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,\" +\n    \"8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,\" +\n    \"8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,\" +\n    \"8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,\" +\n    \"nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,\" +\n    \"rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,\" +\n    \"Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,\" +\n    \"80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,\" +\n    \"811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro\",\n  32\n);\n\nexport const STYLES = {\n  strokeStyle: {\n    svgAttr: \"stroke\", //corresponding svg attribute\n    canvas: \"#000000\", //canvas default\n    svg: \"none\", //svg default\n    apply: \"stroke\", //apply on stroke() or fill()\n  },\n  fillStyle: {\n    svgAttr: \"fill\",\n    canvas: \"#000000\",\n    svg: null, //svg default is black, but we need to special case this to handle canvas stroke without fill\n    apply: \"fill\",\n  },\n  lineCap: {\n    svgAttr: \"stroke-linecap\",\n    canvas: \"butt\",\n    svg: \"butt\",\n    apply: \"stroke\",\n  },\n  lineJoin: {\n    svgAttr: \"stroke-linejoin\",\n    canvas: \"miter\",\n    svg: \"miter\",\n    apply: \"stroke\",\n  },\n  miterLimit: {\n    svgAttr: \"stroke-miterlimit\",\n    canvas: 10,\n    svg: 4,\n    apply: \"stroke\",\n  },\n  lineWidth: {\n    svgAttr: \"stroke-width\",\n    canvas: 1,\n    svg: 1,\n    apply: \"stroke\",\n  },\n  globalAlpha: {\n    svgAttr: \"opacity\",\n    canvas: 1,\n    svg: 1,\n    apply: \"fill stroke\",\n  },\n  font: {\n    //font converts to multiple svg attributes, there is custom logic for this\n    canvas: \"10px sans-serif\",\n  },\n  shadowColor: {\n    canvas: \"#000000\",\n  },\n  shadowOffsetX: {\n    canvas: 0,\n  },\n  shadowOffsetY: {\n    canvas: 0,\n  },\n  shadowBlur: {\n    canvas: 0,\n  },\n  textAlign: {\n    canvas: \"start\",\n  },\n  textBaseline: {\n    canvas: \"alphabetic\",\n  },\n  lineDash: {\n    svgAttr: \"stroke-dasharray\",\n    canvas: [],\n    svg: null,\n    apply: \"stroke\",\n  },\n};\n\nexport class CanvasGradient {\n  __root: any;\n  __ctx: any;\n  constructor(gradientNode: any, ctx: any) {\n    this.__root = gradientNode;\n    this.__ctx = ctx;\n  }\n\n  addColorStop(offset: number, color: string) {\n    var stop = this.__ctx.__createElement(\"stop\"),\n      regex,\n      matches;\n    stop.setAttribute(\"offset\", offset);\n    if (color.indexOf(\"rgba\") !== -1) {\n      //separate alpha value, since webkit can't handle it\n      regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\n      matches = regex.exec(color);\n      if (matches) {\n        stop.setAttribute(\n          \"stop-color\",\n          format(\"rgb({r},{g},{b})\", {\n            r: matches[1],\n            g: matches[2],\n            b: matches[3],\n          })\n        );\n        stop.setAttribute(\"stop-opacity\", matches[4]);\n      }\n    } else {\n      stop.setAttribute(\"stop-color\", color);\n    }\n    this.__root.appendChild(stop);\n  }\n}\n\nexport class CanvasPattern {\n  __root: any;\n  __ctx: any;\n  constructor(patternNode: any, ctx: any) {\n    this.__root = patternNode;\n    this.__ctx = ctx;\n  }\n}\n","import {\n  format,\n  getDominantBaseline,\n  getTextAnchor,\n  normalize,\n  randomString,\n} from \"./helpers\";\nimport { STYLES, CanvasPattern, CanvasGradient, namedEntities } from \"./shared\";\n\ntype Options = {\n  width: number;\n  height: number;\n  enableMirroring: boolean;\n  document?: Document;\n  ctx?: CanvasRenderingContext2D;\n};\nconst defaultOptions: Options = {\n  width: 500,\n  height: 500,\n  enableMirroring: false,\n};\n\nexport class CanvasToSvg {\n  width: number;\n  height: number;\n  enableMirroring: boolean;\n  canvas: CanvasToSvg;\n  __document: Document;\n  __canvas?: HTMLCanvasElement;\n  __ctx: CanvasRenderingContext2D;\n  __ids: { [key: string]: string };\n  __root: SVGSVGElement;\n  __defs: SVGElement;\n  __currentElement: SVGElement | undefined;\n  __groupStack: SVGElement[];\n  __currentElementsToStyle: null | { element: any; children: any[] } = null;\n  [k: string]: any;\n\n  constructor(width?: number, height?: number);\n  constructor(options: Options | number = defaultOptions, height?: number) {\n    let __ctx;\n    if (typeof options === \"number\") {\n      this.width = options;\n      this.height = height ?? defaultOptions.height;\n      this.enableMirroring = defaultOptions.enableMirroring;\n      this.__document = document;\n    } else {\n      this.width = options.width ?? defaultOptions.width;\n      this.height = options.height ?? defaultOptions.height;\n      this.enableMirroring =\n        options.enableMirroring ?? defaultOptions.enableMirroring;\n      this.__document = options.document || document;\n      __ctx = options.ctx;\n    }\n\n    if (!__ctx) {\n      // allow passing in an existing context to wrap around\n      // if a context is passed in, we know a canvas already exist\n      this.__canvas = this.__document.createElement(\"canvas\");\n      __ctx = this.__canvas.getContext(\"2d\");\n      if (!__ctx) throw new Error(\"Unable to get canvas context\");\n    }\n\n    this.__ctx = __ctx;\n    this.canvas = this; ///point back to this instance!\n\n    this.__setDefaultStyles();\n    this.__stack = [this.__getStyleState()];\n    this.__groupStack = [];\n\n    //the root svg element\n    this.__root = this.__document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"svg\"\n    );\n    this.__root.setAttribute(\"version\", \"1.1\");\n    this.__root.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    this.__root.setAttributeNS(\n      \"http://www.w3.org/2000/xmlns/\",\n      \"xmlns:xlink\",\n      \"http://www.w3.org/1999/xlink\"\n    );\n    this.__root.setAttribute(\"width\", this.width.toString());\n    this.__root.setAttribute(\"height\", this.height.toString());\n\n    //make sure we don't generate the same ids in defs\n    this.__ids = {};\n\n    //defs tag\n    this.__defs = this.__document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"defs\"\n    );\n    this.__root.appendChild(this.__defs);\n\n    //also add a group child. the svg element can't use the transform attribute\n    this.__currentElement = this.__document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"g\"\n    );\n    this.__root.appendChild(this.__currentElement);\n  }\n\n  __createElement(elementName: string, properties?: any, resetFill?: boolean) {\n    console.log(\"createElement\", this.__root);\n    if (typeof properties === \"undefined\") {\n      properties = {};\n    }\n\n    var element = this.__document.createElementNS(\n        \"http://www.w3.org/2000/svg\",\n        elementName\n      ),\n      keys = Object.keys(properties),\n      i,\n      key;\n    if (resetFill) {\n      //if fill or stroke is not specified, the svg element should not display. By default SVG's fill is black.\n      element.setAttribute(\"fill\", \"none\");\n      element.setAttribute(\"stroke\", \"none\");\n    }\n    for (i = 0; i < keys.length; i++) {\n      key = keys[i];\n      element.setAttribute(key, properties[key]);\n    }\n    return element;\n  }\n\n  __setDefaultStyles() {\n    console.log(\"setDefaultStyles\", this.__root);\n    //default 2d canvas context properties see:http://www.w3.org/TR/2dcontext/\n    for (let key in STYLES) {\n      this[key] = STYLES[key as keyof typeof STYLES].canvas;\n    }\n  }\n\n  /**\n   * Applies styles on restore\n   */\n  __applyStyleState(styleState: any) {\n    console.log(\"applyStyleState\", this.__root);\n    let keys = Object.keys(styleState),\n      i,\n      key;\n    for (i = 0; i < keys.length; i++) {\n      key = keys[i];\n      this[key] = styleState[key];\n    }\n  }\n\n  /**\n   * Gets the current style state\n   */\n  __getStyleState() {\n    console.log(\"getStyleState\", this.__root);\n    let i,\n      styleState = {} as any,\n      keys = Object.keys(STYLES),\n      key;\n    for (i = 0; i < keys.length; i++) {\n      key = keys[i];\n      styleState[key] = this[key];\n    }\n    return styleState;\n  }\n\n  /**\n   * Applies the current styles to the current SVG element. On \"ctx.fill\" or \"ctx.stroke\"\n   */\n  __applyStyleToCurrentElement(type: \"stroke\" | \"fill\") {\n    if (!this.__currentElement) return;\n    let currentElement = this.__currentElement;\n\n    let keys = Object.keys(STYLES),\n      i,\n      style,\n      value,\n      id,\n      regex,\n      matches;\n    for (i = 0; i < keys.length; i++) {\n      style = STYLES[keys[i] as keyof typeof STYLES];\n      value = this[keys[i]];\n      if (\"apply\" in style) {\n        //is this a gradient or pattern?\n        if (value instanceof CanvasPattern) {\n          //pattern\n          if (value.__ctx) {\n            //copy over defs\n            while (value.__ctx.__defs.childNodes.length) {\n              id = value.__ctx.__defs.childNodes[0].getAttribute(\"id\");\n              this.__ids[id] = id;\n              this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);\n            }\n          }\n          currentElement.setAttribute(\n            style.apply,\n            format(\"url(#{id})\", { id: value.__root.getAttribute(\"id\") })\n          );\n        } else if (value instanceof CanvasGradient) {\n          //gradient\n          currentElement.setAttribute(\n            style.apply,\n            format(\"url(#{id})\", { id: value.__root.getAttribute(\"id\") })\n          );\n        } else if (style.apply.indexOf(type) !== -1 && style.svg !== value) {\n          if (\n            (style.svgAttr === \"stroke\" || style.svgAttr === \"fill\") &&\n            value.indexOf(\"rgba\") !== -1\n          ) {\n            //separate alpha value, since illustrator can't handle it\n            regex =\n              /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\n            matches = regex.exec(value);\n            if (matches) {\n              currentElement.setAttribute(\n                style.svgAttr,\n                format(\"rgb({r},{g},{b})\", {\n                  r: matches[1],\n                  g: matches[2],\n                  b: matches[3],\n                })\n              );\n              //should take globalAlpha here\n              let opacity = parseFloat(matches[4]);\n              let globalAlpha = this.globalAlpha;\n              if (globalAlpha != null) {\n                opacity *= globalAlpha;\n              }\n              currentElement.setAttribute(\n                style.svgAttr + \"-opacity\",\n                opacity.toString()\n              );\n            }\n          } else {\n            let attr = style.svgAttr;\n            if (keys[i] === \"globalAlpha\") {\n              attr = type + \"-\" + style.svgAttr;\n              if (currentElement.getAttribute(attr)) {\n                //fill-opacity or stroke-opacity has already been set by stroke or fill.\n                continue;\n              }\n            }\n            //otherwise only update attribute if right type, and not svg default\n            currentElement.setAttribute(attr, value);\n          }\n        }\n      }\n    }\n  }\n\n  __closestGroupOrSvg(\n    node: SVGElement | ParentNode | undefined | null = this.__currentElement\n  ): SVGElement | void {\n    console.log(\"closestGroupOrSvg\", this.__root);\n    if (!node) return;\n    if (node.nodeName === \"g\" || node.nodeName === \"svg\")\n      return node as SVGElement;\n    return this.__closestGroupOrSvg(node.parentNode);\n  }\n\n  /**\n   * Returns the serialized value of the svg so far\n   * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.\n   *                           If true, we attempt to find all named entities and encode it as a numeric entity.\n   * @return serialized svg\n   */\n  getSerializedSvg(fixNamedEntities: boolean) {\n    console.log(\"getSerializedSvg\", this.__root);\n    let serialized = new XMLSerializer().serializeToString(this.__root),\n      keys,\n      i,\n      key,\n      value,\n      regexp,\n      xmlns;\n\n    //IE search for a duplicate xmnls because they didn't implement setAttributeNS correctly\n    xmlns =\n      /xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg\".+xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg/gi;\n    if (xmlns.test(serialized)) {\n      serialized = serialized.replace(\n        'xmlns=\"http://www.w3.org/2000/svg',\n        'xmlns:xlink=\"http://www.w3.org/1999/xlink'\n      );\n    }\n\n    if (fixNamedEntities) {\n      keys = Object.keys(namedEntities);\n      //loop over each named entity and replace with the proper equivalent.\n      for (i = 0; i < keys.length; i++) {\n        key = keys[i];\n        value = namedEntities[key];\n        regexp = new RegExp(key, \"gi\");\n        if (regexp.test(serialized)) {\n          serialized = serialized.replace(regexp, value);\n        }\n      }\n    }\n\n    return serialized;\n  }\n  /**\n   * Returns the root svg\n   * @return\n   */\n  getSvg() {\n    console.log(\"getSvg\", this.__root);\n    return this.__root;\n  }\n\n  /**\n   * Will generate a group tag.\n   */\n  save() {\n    console.log(\"save\", this.__root);\n    const group = this.__createElement(\"g\");\n    const parent = this.__closestGroupOrSvg();\n    if (parent) this.__groupStack.push(parent);\n    (parent as Node).appendChild(group);\n    this.__currentElement = group;\n    this.__stack.push(this.__getStyleState());\n  }\n\n  /**\n   * Sets current element to parent, or just root if already root\n   */\n  restore() {\n    console.log(\"restore\", this.__root);\n    this.__currentElement = this.__groupStack.pop();\n    this.__currentElementsToStyle = null;\n    //Clearing canvas will make the poped group invalid, currentElement is set to the root group node.\n    if (!this.__currentElement) {\n      this.__currentElement = this.__root.childNodes[1] as SVGElement;\n    }\n    let state = this.__stack.pop();\n    this.__applyStyleState(state);\n  }\n\n  /**\n   * Helper method to add transform\n   * @private\n   */\n  __addTransform(t: any) {\n    console.log(\"addTransform\", this.__root);\n    if (!this.__currentElement) return;\n    //if the current element has siblings, add another group\n    const parent = this.__closestGroupOrSvg();\n    if (!parent) return;\n    if (parent.childNodes.length > 0) {\n      if (this.__currentElement.nodeName === \"path\") {\n        if (!this.__currentElementsToStyle)\n          this.__currentElementsToStyle = { element: parent, children: [] };\n        this.__currentElementsToStyle.children.push(this.__currentElement);\n        this.__applyCurrentDefaultPath();\n      }\n\n      let group = this.__createElement(\"g\");\n      parent.appendChild(group);\n      this.__currentElement = group;\n    }\n\n    if (!this.__currentElement) return;\n    let transform = this.__currentElement.getAttribute(\"transform\");\n    if (transform) {\n      transform += \" \";\n    } else {\n      transform = \"\";\n    }\n    transform += t;\n    this.__currentElement.setAttribute(\"transform\", transform);\n  }\n\n  /**\n   *  scales the current element\n   */\n  scale(x: any, y: any) {\n    console.log(\"scale\", this.__root);\n    if (y === undefined) {\n      y = x;\n    }\n    this.__addTransform(format(\"scale({x},{y})\", { x: x, y: y }));\n  }\n\n  /**\n   * rotates the current element\n   */\n  rotate(angle: any) {\n    console.log(\"rotate\", this.__root);\n    let degrees = (angle * 180) / Math.PI;\n    this.__addTransform(\n      format(\"rotate({angle},{cx},{cy})\", { angle: degrees, cx: 0, cy: 0 })\n    );\n  }\n\n  /**\n   * translates the current element\n   */\n  translate(x: any, y: any) {\n    console.log(\"translate\", this.__root);\n    this.__addTransform(format(\"translate({x},{y})\", { x: x, y: y }));\n  }\n\n  /**\n   * applies a transform to the current element\n   */\n  transform(a: any, b: any, c: any, d: any, e: any, f: any) {\n    console.log(\"transform\", this.__root);\n    this.__addTransform(\n      format(\"matrix({a},{b},{c},{d},{e},{f})\", {\n        a: a,\n        b: b,\n        c: c,\n        d: d,\n        e: e,\n        f: f,\n      })\n    );\n  }\n\n  /**\n   * Create a new Path Element\n   */\n  beginPath() {\n    console.log(\"beginPath\", this.__root);\n    let path, parent;\n\n    // Note that there is only one current default path, it is not part of the drawing state.\n    // See also: https://html.spec.whatwg.org/multipage/scripting.html#current-default-path\n    this.__currentDefaultPath = \"\";\n    this.__currentPosition = {};\n\n    path = this.__createElement(\"path\", {}, true);\n    parent = this.__closestGroupOrSvg();\n    if (!parent) return;\n    parent.appendChild(path);\n    this.__currentElement = path;\n  }\n\n  /**\n   * Helper function to apply currentDefaultPath to current path element\n   * @private\n   */\n  __applyCurrentDefaultPath() {\n    console.log(\"applyCurrentDefaultPath\", this.__root);\n    let currentElement = this.__currentElement;\n    if (!currentElement) return;\n    if (currentElement.nodeName === \"path\") {\n      currentElement.setAttribute(\"d\", this.__currentDefaultPath);\n    } else {\n      console.error(\n        \"Attempted to apply path command to node\",\n        currentElement.nodeName\n      );\n    }\n  }\n\n  /**\n   * Helper function to add path command\n   * @private\n   */\n  __addPathCommand(command: any) {\n    console.log(\"addPathCommand\", this.__root);\n    this.__currentDefaultPath += \" \";\n    this.__currentDefaultPath += command;\n  }\n\n  /**\n   * Adds the move command to the current path element,\n   * if the currentPathElement is not empty create a new path element\n   */\n  moveTo(x: number, y: number) {\n    console.log(\"moveTo\", this.__root);\n    if (!this.__currentElement) return;\n    if (this.__currentElement.nodeName !== \"path\") {\n      this.beginPath();\n    }\n\n    // creates a new subpath with the given point\n    this.__currentPosition = { x: x, y: y };\n    this.__addPathCommand(format(\"M {x} {y}\", { x: x, y: y }));\n  }\n\n  /**\n   * Closes the current path\n   */\n  closePath() {\n    console.log(\"closePath\", this.__root);\n    if (this.__currentDefaultPath) {\n      this.__addPathCommand(\"Z\");\n    }\n  }\n\n  /**\n   * Adds a line to command\n   */\n  lineTo(x: any, y: any) {\n    console.log(\"lineTo\", this.__root);\n    this.__currentPosition = { x: x, y: y };\n    if (this.__currentDefaultPath.indexOf(\"M\") > -1) {\n      this.__addPathCommand(format(\"L {x} {y}\", { x: x, y: y }));\n    } else {\n      this.__addPathCommand(format(\"M {x} {y}\", { x: x, y: y }));\n    }\n  }\n\n  /**\n   * Add a bezier command\n   */\n  bezierCurveTo(cp1x: any, cp1y: any, cp2x: any, cp2y: any, x: any, y: any) {\n    console.log(\"bezierCurveTo\", this.__root);\n    this.__currentPosition = { x: x, y: y };\n    this.__addPathCommand(\n      format(\"C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}\", {\n        cp1x: cp1x,\n        cp1y: cp1y,\n        cp2x: cp2x,\n        cp2y: cp2y,\n        x: x,\n        y: y,\n      })\n    );\n  }\n\n  /**\n   * Adds a quadratic curve to command\n   */\n  quadraticCurveTo(cpx: any, cpy: any, x: any, y: any) {\n    console.log(\"quadraticCurveTo\", this.__root);\n    this.__currentPosition = { x: x, y: y };\n    this.__addPathCommand(\n      format(\"Q {cpx} {cpy} {x} {y}\", { cpx: cpx, cpy: cpy, x: x, y: y })\n    );\n  }\n\n  /**\n   * Adds the arcTo to the current path\n   *\n   * @see http://www.w3.org/TR/2015/WD-2dcontext-20150514/#dom-context-2d-arcto\n   */\n  arcTo(x1: any, y1: any, x2: any, y2: any, radius: any) {\n    console.log(\"arcTo\", this.__root);\n    // Let the point (x0, y0) be the last point in the subpath.\n    let x0 = this.__currentPosition && this.__currentPosition.x;\n    let y0 = this.__currentPosition && this.__currentPosition.y;\n\n    // First ensure there is a subpath for (x1, y1).\n    if (typeof x0 == \"undefined\" || typeof y0 == \"undefined\") {\n      return;\n    }\n\n    // Negative values for radius must cause the implementation to throw an IndexSizeError exception.\n    if (radius < 0) {\n      throw new Error(\n        \"IndexSizeError: The radius provided (\" + radius + \") is negative.\"\n      );\n    }\n\n    // If the point (x0, y0) is equal to the point (x1, y1),\n    // or if the point (x1, y1) is equal to the point (x2, y2),\n    // or if the radius radius is zero,\n    // then the method must add the point (x1, y1) to the subpath,\n    // and connect that point to the previous point (x0, y0) by a straight line.\n    if ((x0 === x1 && y0 === y1) || (x1 === x2 && y1 === y2) || radius === 0) {\n      this.lineTo(x1, y1);\n      return;\n    }\n\n    // Otherwise, if the points (x0, y0), (x1, y1), and (x2, y2) all lie on a single straight line,\n    // then the method must add the point (x1, y1) to the subpath,\n    // and connect that point to the previous point (x0, y0) by a straight line.\n    let unit_vec_p1_p0 = normalize([x0 - x1, y0 - y1]);\n    let unit_vec_p1_p2 = normalize([x2 - x1, y2 - y1]);\n    if (\n      unit_vec_p1_p0[0] * unit_vec_p1_p2[1] ===\n      unit_vec_p1_p0[1] * unit_vec_p1_p2[0]\n    ) {\n      this.lineTo(x1, y1);\n      return;\n    }\n\n    // Otherwise, let The Arc be the shortest arc given by circumference of the circle that has radius radius,\n    // and that has one point tangent to the half-infinite line that crosses the point (x0, y0) and ends at the point (x1, y1),\n    // and that has a different point tangent to the half-infinite line that ends at the point (x1, y1), and crosses the point (x2, y2).\n    // The points at which this circle touches these two lines are called the start and end tangent points respectively.\n\n    // note that both vectors are unit vectors, so the length is 1\n    let cos =\n      unit_vec_p1_p0[0] * unit_vec_p1_p2[0] +\n      unit_vec_p1_p0[1] * unit_vec_p1_p2[1];\n    let theta = Math.acos(Math.abs(cos));\n\n    // Calculate origin\n    let unit_vec_p1_origin = normalize([\n      unit_vec_p1_p0[0] + unit_vec_p1_p2[0],\n      unit_vec_p1_p0[1] + unit_vec_p1_p2[1],\n    ]);\n    let len_p1_origin = radius / Math.sin(theta / 2);\n    let x = x1 + len_p1_origin * unit_vec_p1_origin[0];\n    let y = y1 + len_p1_origin * unit_vec_p1_origin[1];\n\n    // Calculate start angle and end angle\n    // rotate 90deg clockwise (note that y axis points to its down)\n    let unit_vec_origin_start_tangent = [-unit_vec_p1_p0[1], unit_vec_p1_p0[0]];\n    // rotate 90deg counter clockwise (note that y axis points to its down)\n    let unit_vec_origin_end_tangent = [unit_vec_p1_p2[1], -unit_vec_p1_p2[0]];\n    let getAngle = (vector: number[]) => {\n      // get angle (clockwise) between vector and (1, 0)\n      let x = vector[0];\n      let y = vector[1];\n      if (y >= 0) {\n        // note that y axis points to its down\n        return Math.acos(x);\n      } else {\n        return -Math.acos(x);\n      }\n    };\n    let startAngle = getAngle(unit_vec_origin_start_tangent);\n    let endAngle = getAngle(unit_vec_origin_end_tangent);\n\n    // Connect the point (x0, y0) to the start tangent point by a straight line\n    this.lineTo(\n      x + unit_vec_origin_start_tangent[0] * radius,\n      y + unit_vec_origin_start_tangent[1] * radius\n    );\n\n    // Connect the start tangent point to the end tangent point by arc\n    // and adding the end tangent point to the subpath.\n    this.arc(x, y, radius, startAngle, endAngle);\n  }\n\n  /**\n   * Sets the stroke property on the current element\n   */\n  stroke() {\n    console.log(\"stroke\", this.__root);\n    if (!this.__currentElement) return;\n    if (this.__currentElement.nodeName === \"path\") {\n      this.__currentElement.setAttribute(\"paint-order\", \"fill stroke markers\");\n    }\n    this.__applyCurrentDefaultPath();\n    this.__applyStyleToCurrentElement(\"stroke\");\n  }\n\n  /**\n   * Sets fill properties on the current element\n   */\n  fill() {\n    console.log(\"fill\", this.__root);\n    debugger;\n    if (!this.__currentElement) return;\n    if (this.__currentElement.nodeName === \"path\") {\n      this.__currentElement.setAttribute(\"paint-order\", \"stroke fill markers\");\n    }\n    this.__applyCurrentDefaultPath();\n    this.__applyStyleToCurrentElement(\"fill\");\n  }\n\n  /**\n   *  Adds a rectangle to the path.\n   */\n  rect(x: any, y: any, width: any, height: any) {\n    console.log(\"rect\", this.__root);\n    if (!this.__currentElement) return;\n    if (this.__currentElement.nodeName !== \"path\") {\n      this.beginPath();\n    }\n    this.moveTo(x, y);\n    this.lineTo(x + width, y);\n    this.lineTo(x + width, y + height);\n    this.lineTo(x, y + height);\n    this.lineTo(x, y);\n    this.closePath();\n  }\n\n  /**\n   * adds a rectangle element\n   */\n  fillRect(x: any, y: any, width: any, height: any) {\n    console.log(\"fillRect\", this.__root);\n    let rect, parent;\n    rect = this.__createElement(\n      \"rect\",\n      {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n      },\n      true\n    );\n    parent = this.__closestGroupOrSvg();\n    (parent as Node).appendChild(rect);\n    this.__currentElement = rect;\n    this.__applyStyleToCurrentElement(\"fill\");\n  }\n\n  /**\n   * Draws a rectangle with no fill\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  strokeRect(x: any, y: any, width: any, height: any) {\n    console.log(\"strokeRect\", this.__root);\n    let rect, parent;\n    rect = this.__createElement(\n      \"rect\",\n      {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n      },\n      true\n    );\n    parent = this.__closestGroupOrSvg();\n    (parent as Node).appendChild(rect);\n    this.__currentElement = rect;\n    this.__applyStyleToCurrentElement(\"stroke\");\n  }\n\n  /**\n   * Clear entire canvas:\n   * 1. save current transforms\n   * 2. remove all the childNodes of the root g element\n   */\n  __clearCanvas() {\n    console.log(\"clearCanvas\", this.__root);\n    let current = this.__closestGroupOrSvg();\n    if (!current) return;\n    let transform = current.getAttribute(\"transform\");\n    let rootGroup = this.__root.childNodes[1];\n    let childNodes = rootGroup.childNodes;\n    for (let i = childNodes.length - 1; i >= 0; i--) {\n      if (childNodes[i]) {\n        rootGroup.removeChild(childNodes[i]);\n      }\n    }\n    this.__currentElement = rootGroup as SVGElement;\n    //reset __groupStack as all the child group nodes are all removed.\n    this.__groupStack = [];\n    if (transform) {\n      this.__addTransform(transform);\n    }\n  }\n\n  /**\n   * \"Clears\" a canvas by just drawing a white rectangle in the current group.\n   */\n  clearRect(x: any, y: any, width: any, height: any) {\n    console.log(\"clearRect\", this.__root);\n    //clear entire canvas\n    if (x === 0 && y === 0 && width === this.width && height === this.height) {\n      this.__clearCanvas();\n      return;\n    }\n    let rect,\n      parent = this.__closestGroupOrSvg();\n    rect = this.__createElement(\n      \"rect\",\n      {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n        fill: \"#FFFFFF\",\n      },\n      true\n    );\n    (parent as Node).appendChild(rect);\n  }\n\n  /**\n   * Adds a linear gradient to a defs tag.\n   * Returns a canvas gradient object that has a reference to it's parent def\n   */\n  createLinearGradient(x1: any, y1: any, x2: any, y2: any) {\n    console.log(\"createLinearGradient\", this.__root);\n    let grad = this.__createElement(\n      \"linearGradient\",\n      {\n        id: randomString(this.__ids),\n        x1: x1 + \"px\",\n        x2: x2 + \"px\",\n        y1: y1 + \"px\",\n        y2: y2 + \"px\",\n        gradientUnits: \"userSpaceOnUse\",\n      },\n      false\n    );\n    this.__defs.appendChild(grad);\n    return new CanvasGradient(grad, this);\n  }\n\n  /**\n   * Adds a radial gradient to a defs tag.\n   * Returns a canvas gradient object that has a reference to it's parent def\n   */\n  createRadialGradient(x0: any, y0: any, r0: any, x1: any, y1: any, r1: any) {\n    console.log(\"createRadialGradient\", this.__root);\n    let grad = this.__createElement(\n      \"radialGradient\",\n      {\n        id: randomString(this.__ids),\n        cx: x1 + \"px\",\n        cy: y1 + \"px\",\n        r: r1 + \"px\",\n        fx: x0 + \"px\",\n        fy: y0 + \"px\",\n        gradientUnits: \"userSpaceOnUse\",\n      },\n      false\n    );\n    this.__defs.appendChild(grad);\n    return new CanvasGradient(grad, this);\n  }\n\n  /**\n   * Parses the font string and returns svg mapping\n   * @private\n   */\n  __parseFont() {\n    console.log(\"parseFont\", this.__root);\n    let regex =\n      /^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-,\\'\\\"\\sa-z0-9]+?)\\s*$/i;\n    let fontPart = regex.exec(this.font);\n    if (!fontPart) return;\n    let data = {\n      style: fontPart[1] || \"normal\",\n      size: fontPart[4] || \"10px\",\n      family: fontPart[6] || \"sans-serif\",\n      weight: fontPart[3] || \"normal\",\n      decoration: fontPart[2] || \"normal\",\n      href: null,\n    };\n\n    //canvas doesn't support underline natively, but we can pass this attribute\n    if (this.__fontUnderline === \"underline\") {\n      data.decoration = \"underline\";\n    }\n\n    //canvas also doesn't support linking, but we can pass this as well\n    if (this.__fontHref) {\n      data.href = this.__fontHref;\n    }\n\n    return data;\n  }\n\n  /**\n   * Helper to link text fragments\n   * @param font\n   * @param element\n   * @return {*}\n   * @private\n   */\n  __wrapTextLink(font: any, element: any) {\n    console.log(\"wrapTextLink\", this.__root);\n    if (font.href) {\n      let a = this.__createElement(\"a\");\n      a.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", font.href);\n      a.appendChild(element);\n      return a;\n    }\n    return element;\n  }\n\n  /**\n   * Fills or strokes text\n   * @param text\n   * @param x\n   * @param y\n   * @param action - stroke or fill\n   * @private\n   */\n  __applyText(text: any, x: any, y: any, action: any) {\n    console.log(\"applyText\", this.__root);\n    let font = this.__parseFont(),\n      parent = this.__closestGroupOrSvg();\n    if (!font) return;\n    let textElement = this.__createElement(\n      \"text\",\n      {\n        \"font-family\": font.family,\n        \"font-size\": font.size,\n        \"font-style\": font.style,\n        \"font-weight\": font.weight,\n        \"text-decoration\": font.decoration,\n        x: x,\n        y: y,\n        \"text-anchor\": getTextAnchor(this.textAlign),\n        \"dominant-baseline\": getDominantBaseline(this.textBaseline),\n      },\n      true\n    );\n\n    textElement.appendChild(this.__document.createTextNode(text));\n    this.__currentElement = textElement;\n    this.__applyStyleToCurrentElement(action);\n    (parent as Node).appendChild(this.__wrapTextLink(font, textElement));\n  }\n\n  /**\n   * Creates a text element\n   * @param text\n   * @param x\n   * @param y\n   */\n  fillText(text: any, x: any, y: any) {\n    console.log(\"fillText\", this.__root);\n    this.__applyText(text, x, y, \"fill\");\n  }\n\n  /**\n   * Strokes text\n   * @param text\n   * @param x\n   * @param y\n   */\n  strokeText(text: any, x: any, y: any) {\n    console.log(\"strokeText\", this.__root);\n    this.__applyText(text, x, y, \"stroke\");\n  }\n\n  /**\n   * No need to implement this for svg.\n   * @param text\n   * @return {TextMetrics}\n   */\n  measureText(text: any) {\n    console.log(\"measureText\", this.__root);\n    this.__ctx.font = this.font;\n    return this.__ctx.measureText(text);\n  }\n\n  /**\n   *  Arc command!: any\n   */\n  arc(\n    x: any,\n    y: any,\n    radius: any,\n    startAngle: any,\n    endAngle: any,\n    counterClockwise?: any\n  ) {\n    console.log(\"arc\", this.__root);\n    // in canvas no circle is drawn if no angle is provided.\n    if (startAngle === endAngle) {\n      return;\n    }\n    startAngle = startAngle % (2 * Math.PI);\n    endAngle = endAngle % (2 * Math.PI);\n    if (startAngle === endAngle) {\n      //circle time! subtract some of the angle so svg is happy (svg elliptical arc can't draw a full circle)\n      endAngle =\n        (endAngle + 2 * Math.PI - 0.001 * (counterClockwise ? -1 : 1)) %\n        (2 * Math.PI);\n    }\n    let endX = x + radius * Math.cos(endAngle),\n      endY = y + radius * Math.sin(endAngle),\n      startX = x + radius * Math.cos(startAngle),\n      startY = y + radius * Math.sin(startAngle),\n      sweepFlag = counterClockwise ? 0 : 1,\n      largeArcFlag = 0,\n      diff = endAngle - startAngle;\n\n    // https://github.com/gliffy/canvas2svg/issues/4\n    if (diff < 0) {\n      diff += 2 * Math.PI;\n    }\n\n    if (counterClockwise) {\n      largeArcFlag = diff > Math.PI ? 0 : 1;\n    } else {\n      largeArcFlag = diff > Math.PI ? 1 : 0;\n    }\n\n    this.lineTo(startX, startY);\n    this.__addPathCommand(\n      format(\n        \"A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}\",\n        {\n          rx: radius,\n          ry: radius,\n          xAxisRotation: 0,\n          largeArcFlag: largeArcFlag,\n          sweepFlag: sweepFlag,\n          endX: endX,\n          endY: endY,\n        }\n      )\n    );\n\n    this.__currentPosition = { x: endX, y: endY };\n  }\n\n  /**\n   * Generates a ClipPath from the clip command.\n   */\n  clip() {\n    console.log(\"clip\", this.__root);\n    let group = this.__closestGroupOrSvg(),\n      clipPath = this.__createElement(\"clipPath\"),\n      id = randomString(this.__ids),\n      newGroup = this.__createElement(\"g\");\n    if (!group) return;\n    if (!this.__currentElement) return;\n    this.__applyCurrentDefaultPath();\n    group.removeChild(this.__currentElement);\n    clipPath.setAttribute(\"id\", id);\n    clipPath.appendChild(this.__currentElement);\n\n    this.__defs.appendChild(clipPath);\n\n    //set the clip path to this group\n    group.setAttribute(\"clip-path\", format(\"url(#{id})\", { id: id }));\n\n    //clip paths can be scaled and transformed, we need to add another wrapper group to avoid later transformations\n    // to this path\n    group.appendChild(newGroup);\n\n    this.__currentElement = newGroup;\n  }\n\n  /**\n   * Draws a canvas, image or mock context to this canvas.\n   * Note that all svg dom manipulation uses node.childNodes rather than node.children for IE support.\n   * http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-drawimage\n   */\n  drawImage() {\n    console.log(\"drawImage\", this.__root);\n    //convert arguments to a real array\n    let args = Array.prototype.slice.call(arguments),\n      image = args[0],\n      dx,\n      dy,\n      dw,\n      dh,\n      sx = 0,\n      sy = 0,\n      sw,\n      sh,\n      parent,\n      svg,\n      defs,\n      group,\n      currentElement,\n      svgImage,\n      canvas,\n      context,\n      id;\n\n    if (args.length === 3) {\n      dx = args[1];\n      dy = args[2];\n      sw = image.width;\n      sh = image.height;\n      dw = sw;\n      dh = sh;\n    } else if (args.length === 5) {\n      dx = args[1];\n      dy = args[2];\n      dw = args[3];\n      dh = args[4];\n      sw = image.width;\n      sh = image.height;\n    } else if (args.length === 9) {\n      sx = args[1];\n      sy = args[2];\n      sw = args[3];\n      sh = args[4];\n      dx = args[5];\n      dy = args[6];\n      dw = args[7];\n      dh = args[8];\n    } else {\n      throw new Error(\n        \"Invalid number of arguments passed to drawImage: \" + arguments.length\n      );\n    }\n\n    parent = this.__closestGroupOrSvg();\n    currentElement = this.__currentElement;\n    let translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\n    if (image instanceof CanvasToSvg) {\n      //canvas2svg mock canvas context. In the future we may want to clone nodes instead.\n      //also I'm currently ignoring dw, dh, sw, sh, sx, sy for a mock context.\n      svg = image.getSvg().cloneNode(true);\n      if (svg.childNodes && svg.childNodes.length > 1) {\n        defs = svg.childNodes[0];\n        while (defs.childNodes.length) {\n          id = (defs.childNodes[0] as SVGElement).getAttribute(\"id\") as string;\n          this.__ids[id] = id;\n          this.__defs.appendChild(defs.childNodes[0]);\n        }\n        group = svg.childNodes[1];\n        if (group) {\n          //save original transform\n          let originTransform = (group as SVGElement).getAttribute(\"transform\");\n          let transformDirective;\n          if (originTransform) {\n            transformDirective = originTransform + \" \" + translateDirective;\n          } else {\n            transformDirective = translateDirective;\n          }\n          (group as SVGElement).setAttribute(\"transform\", transformDirective);\n          (parent as Node).appendChild(group);\n        }\n      }\n    } else if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\n      //canvas or image\n      svgImage = this.__createElement(\"image\");\n      svgImage.setAttribute(\"width\", dw);\n      svgImage.setAttribute(\"height\", dh);\n      svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\n\n      if (sx || sy || sw !== image.width || sh !== image.height) {\n        //crop the image using a temporary canvas\n        canvas = this.__document.createElement(\"canvas\");\n        canvas.width = dw;\n        canvas.height = dh;\n        context = canvas.getContext(\"2d\");\n        if (!context) return;\n        context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\n        image = canvas;\n      }\n      svgImage.setAttribute(\"transform\", translateDirective);\n      svgImage.setAttributeNS(\n        \"http://www.w3.org/1999/xlink\",\n        \"xlink:href\",\n        image.nodeName === \"CANVAS\"\n          ? image.toDataURL()\n          : image.getAttribute(\"src\")\n      );\n      (parent as Node).appendChild(svgImage);\n    }\n  }\n\n  /**\n   * Generates a pattern tag\n   */\n  createPattern(image: any, repetition: any) {\n    console.log(\"createPattern\", this.__root);\n    let pattern = this.__document.createElementNS(\n        \"http://www.w3.org/2000/svg\",\n        \"pattern\"\n      ),\n      id = randomString(this.__ids),\n      img;\n    pattern.setAttribute(\"id\", id);\n    pattern.setAttribute(\"width\", image.width);\n    pattern.setAttribute(\"height\", image.height);\n    if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\n      img = this.__document.createElementNS(\n        \"http://www.w3.org/2000/svg\",\n        \"image\"\n      );\n      img.setAttribute(\"width\", image.width);\n      img.setAttribute(\"height\", image.height);\n      img.setAttributeNS(\n        \"http://www.w3.org/1999/xlink\",\n        \"xlink:href\",\n        image.nodeName === \"CANVAS\"\n          ? image.toDataURL()\n          : image.getAttribute(\"src\")\n      );\n      pattern.appendChild(img);\n      this.__defs.appendChild(pattern);\n    } else if (image instanceof CanvasToSvg) {\n      pattern.appendChild(image.__root.childNodes[1]);\n      this.__defs.appendChild(pattern);\n    }\n    return new CanvasPattern(pattern, this);\n  }\n\n  setLineDash(dashArray: any) {\n    console.log(\"setLineDash\", this.__root);\n    if (dashArray && dashArray.length > 0) {\n      this.lineDash = dashArray.join(\",\");\n    } else {\n      this.lineDash = null;\n    }\n  }\n\n  /*\n  ctx.prototype.drawFocusRing = function () {};\n    ctx.prototype.createImageData = function () {};\n    ctx.prototype.getImageData = function () {};\n    ctx.prototype.putImageData = function () {};\n    ctx.prototype.globalCompositeOperation = function () {};\n    ctx.prototype.setTransform = function () {};\n    */\n}\n","import canvasToSvg from \"canvas-to-svg\";\n\nvar CRp = {};\nvar is = {};\n\nis.number = (obj) => obj != null && typeof obj === typeof 1 && !isNaN(obj);\n\nCRp.bufferCanvasImage = function (options, cy) {\n  //disable usePaths temporarily\n  var usePaths = cy.renderer().usePaths;\n  cy.renderer().usePaths = () => {\n    return false;\n  };\n  // flush path cache\n  cy.elements().forEach(function (ele) {\n    ele._private.rscratch.pathCacheKey = null;\n    ele._private.rscratch.pathCache = null;\n  });\n\n  var renderer = cy.renderer();\n  var eles = cy.mutableElements();\n  var bb = eles.boundingBox();\n  var ctrRect = renderer.findContainerClientCoords();\n  var width = options.full ? Math.ceil(bb.w) : ctrRect[2];\n  var height = options.full ? Math.ceil(bb.h) : ctrRect[3];\n  var specdMaxDims =\n    is.number(options.maxWidth) || is.number(options.maxHeight);\n  var pxRatio = renderer.getPixelRatio();\n  var scale = 1;\n\n  if (options.scale !== undefined) {\n    width *= options.scale;\n    height *= options.scale;\n\n    scale = options.scale;\n  } else if (specdMaxDims) {\n    var maxScaleW = Infinity;\n    var maxScaleH = Infinity;\n\n    if (is.number(options.maxWidth)) {\n      maxScaleW = (scale * options.maxWidth) / width;\n    }\n\n    if (is.number(options.maxHeight)) {\n      maxScaleH = (scale * options.maxHeight) / height;\n    }\n\n    scale = Math.min(maxScaleW, maxScaleH);\n\n    width *= scale;\n    height *= scale;\n  }\n\n  if (!specdMaxDims) {\n    width *= pxRatio;\n    height *= pxRatio;\n    scale *= pxRatio;\n  }\n\n  var buffCxt = null;\n  var buffCanvas = (buffCxt = new canvasToSvg(width, height));\n\n  // Rasterize the layers, but only if container has nonzero size\n  if (width > 0 && height > 0) {\n    buffCxt.clearRect(0, 0, width, height);\n\n    // fill background\n    if (options.bg) {\n      buffCxt.globalCompositeOperation = \"destination-over\";\n\n      buffCxt.fillStyle = options.bg;\n      buffCxt.fillRect(0, 0, width, height);\n    }\n\n    buffCxt.globalCompositeOperation = \"source-over\";\n\n    var zsortedEles = renderer.getCachedZSortedEles();\n\n    if (options.full) {\n      // draw the full bounds of the graph\n      buffCxt.translate(-bb.x1 * scale, -bb.y1 * scale);\n      buffCxt.scale(scale, scale);\n\n      renderer.drawElements(buffCxt, zsortedEles);\n\n      buffCxt.scale(1 / scale, 1 / scale);\n      buffCxt.translate(bb.x1 * scale, bb.y1 * scale);\n    } else {\n      // draw the current view\n      var pan = cy.pan();\n\n      var translation = {\n        x: pan.x * scale,\n        y: pan.y * scale,\n      };\n\n      scale *= cy.zoom();\n\n      buffCxt.translate(translation.x, translation.y);\n      buffCxt.scale(scale, scale);\n\n      renderer.drawElements(buffCxt, zsortedEles);\n\n      buffCxt.scale(1 / scale, 1 / scale);\n      buffCxt.translate(-translation.x, -translation.y);\n    }\n  }\n\n  // restore usePaths to default value\n  cy.renderer().usePaths = usePaths;\n  return buffCanvas;\n};\n\nfunction output(canvas) {\n  return canvas.getSerializedSvg();\n}\n\nCRp.svg = function (options) {\n  return output(CRp.bufferCanvasImage(options || {}, this));\n};\n\nexport default CRp;\n","import impl from \"./convert-to-svg.js\";\n\n// registers the extension on a cytoscape lib ref\nlet register = function (cytoscape) {\n  if (!cytoscape) {\n    return;\n  } // can't register if cytoscape unspecified\n\n  cytoscape(\"core\", \"svg\", impl.svg); // register with cytoscape.js\n};\n\nif (typeof cytoscape !== \"undefined\") {\n  // expose to global cytoscape (i.e. window.cytoscape)\n  register(cytoscape);\n}\n\nmodule.exports = register;\n"],"names":["format","str","args","i","keys","Object","length","replace","RegExp","randomString","holder","chars","randomstring","Error","Math","floor","random","getTextAnchorMap","left","right","center","start","end","getDominantBaselineMap","alphabetic","hanging","top","bottom","middle","normalize","vector","len","sqrt","namedEntities","items","radix","entity","base10","lookup","itemsArr","split","parseInt","createNamedToNumberedLookup","STYLES","strokeStyle","svgAttr","canvas","svg","apply","fillStyle","lineCap","lineJoin","miterLimit","lineWidth","globalAlpha","font","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","textAlign","textBaseline","lineDash","CanvasGradient","constructor","gradientNode","ctx","__root","__ctx","this","addColorStop","offset","color","matches","stop","__createElement","setAttribute","indexOf","exec","r","g","b","appendChild","CanvasPattern","patternNode","defaultOptions","width","height","enableMirroring","CanvasToSvg","options","__document","__canvas","__ids","__defs","__currentElement","__groupStack","__currentElementsToStyle","document","createElement","getContext","__setDefaultStyles","__stack","__getStyleState","createElementNS","setAttributeNS","toString","elementName","properties","resetFill","console","log","key","element","__applyStyleState","styleState","__applyStyleToCurrentElement","type","style","value","id","regex","currentElement","childNodes","getAttribute","attr","opacity","parseFloat","__closestGroupOrSvg","node","nodeName","parentNode","getSerializedSvg","fixNamedEntities","regexp","xmlns","serialized","XMLSerializer","serializeToString","test","getSvg","save","group","parent","push","restore","pop","state","__addTransform","t","children","__applyCurrentDefaultPath","transform","scale","x","y","undefined","rotate","angle","degrees","PI","cx","cy","translate","a","c","d","e","f","beginPath","path","__currentDefaultPath","__currentPosition","error","__addPathCommand","command","moveTo","closePath","lineTo","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","quadraticCurveTo","cpx","cpy","arcTo","x1","y1","x2","y2","radius","x0","y0","unit_vec_p1_p0","unit_vec_p1_p2","theta","acos","abs","unit_vec_p1_origin","len_p1_origin","sin","unit_vec_origin_start_tangent","unit_vec_origin_end_tangent","getAngle","startAngle","endAngle","arc","stroke","fill","rect","fillRect","strokeRect","__clearCanvas","current","rootGroup","removeChild","clearRect","createLinearGradient","grad","gradientUnits","createRadialGradient","r0","r1","fx","fy","__parseFont","fontPart","data","size","family","weight","decoration","href","__fontUnderline","__fontHref","__wrapTextLink","__applyText","text","action","textElement","createTextNode","fillText","strokeText","measureText","counterClockwise","endX","cos","endY","startX","startY","sweepFlag","largeArcFlag","diff","rx","ry","xAxisRotation","clip","clipPath","newGroup","drawImage","dx","dy","dw","dh","sw","sh","defs","svgImage","context","Array","prototype","slice","call","arguments","image","sx","sy","translateDirective","cloneNode","transformDirective","originTransform","toDataURL","createPattern","repetition","img","pattern","setLineDash","dashArray","join","canvasToSvg","impl"],"mappings":"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"}